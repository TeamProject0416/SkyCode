<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--User Style-->
    <link th:href="@{/css/reset.css}" rel="stylesheet">
    <link th:href="@{/css/typo.css}" rel="stylesheet">
    <link th:href="@{/css/sub/header.css}" rel="stylesheet">
    <link th:href="@{/css/sub/footer.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/review/reviewShow.css}">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
<header th:replace="~{fragments/sub/header::header}"></header>


<div class="wrap">
    <div class="container">
        <div class="userReviewArea">
            <div class="userReviewTop">
                <div class="userInfo">
                    <div class="userIcon">
                        <i class="fa-solid fa-circle-user"></i>
                    </div>
                    <div class="userNE">
                        <div class="userNickName">
                            <h3 th:text="${reviewShow.nickName}">보라돌이</h3>
                        </div>
                        <div class="userEmail"><span>test1@naver.com</span></div>
                    </div>
                    <div class="newBtn">
                        <a href="#">
                            <button>새 글 작성하기</button>
                        </a>
                    </div>
                </div>
            </div>

            <div class="userReviewContent">
                <div class="slideShow">
                    <ul class="sliders">
                        <li class="slider1" th:each="fileName: ${reviewShow.storedFileName}">
                            <img th:src="@{|/upload/${fileName}|}" alt="">
<!--                            <img src="https://picsum.photos/600/300" alt="userReviewImg">-->
                        </li>
                        <li class="slider2">
                            <img src="https://picsum.photos/600/700" alt="userReviewImg">
                        </li>
                        <li class="slider3">
                            <img src="https://picsum.photos/600/400" alt="userReviewImg">
                        </li>
                    </ul>
                    <div class="pnBtn rightBtn"><i class="fa-solid fa-arrow-right"></i></div>
                    <div class="pnBtn leftBtn"><i class="fa-solid fa-arrow-left"></i></div>
                </div>
                <div class="contentArea">
                    <div class="contentTitleArea">
                        <div class="title">
                            <h2 th:text="${reviewShow.reviewTitle}">테스트리뷰1</h2>
                        </div>
                        <div class="reviewDate">
                            <span th:text="${#temporals.format(reviewShow.reviewCreatedTime, 'yyyy-MM-dd')}"></span>
                        </div>
                        <div class="hashtag"><span>#집보내줘</span></div>
                    </div> <!-- contentTitleArea 끝 -->
                    <div class="mainContent" th:text="${reviewShow.contents}">
                        Lorem ipsum dolor sit amet consectetur adipisicing elit. Pariatur modi laudantium eum harum soluta magni incidunt corporis eius tempora itaque aut doloribus, omnis consectetur commodi architecto saepe voluptas quia vel nihil. Officia officiis eveniet aperiam, voluptates ut a omnis modi accusantium, ad qui inventore hic vel temporibus. Modi quasi ducimus ullam atque, ad natus rerum excepturi ab ipsa ipsam, minus impedit deserunt expedita dolorem omnis minima fugit cupiditate aut eum? Nisi asperiores, illo tempore quasi nobis magnam earum aspernatur cupiditate similique laborum provident itaque repudiandae! Excepturi non accusantium assumenda illum nulla atque sapiente, architecto adipisci vitae corporis sint fuga nostrum id at quaerat dolore. Sapiente, fugit! Natus, quas libero reiciendis tempora perferendis consequuntur sint repudiandae reprehenderit quo eius sit id inventore. Suscipit eveniet deserunt maiores? Minima similique quis perferendis molestiae veniam, consequatur velit nisi minus rerum odio et ullam asperiores recusandae ex nobis fuga animi! Neque, ducimus deleniti molestias consequatur vel hic earum voluptate id sunt laborum quia itaque culpa harum dolores asperiores voluptates corporis reprehenderit deserunt officia error velit. Maiores officia neque ea, quasi unde sed veritatis, aliquid praesentium itaque qui quo voluptates vitae perspiciatis ducimus similique cum accusantium laudantium, nam voluptate laboriosam natus. Corrupti suscipit recusandae cupiditate sunt.
                    </div>
                </div>
            </div>
            <div class="userReviewBt">
                <div class="btns">
                    <a th:href="@{/review/{id}/edit (id=${reviewShow.id})}"><button type="submit" class="editBtn">글 수정</button></a>
                    <a href="/review/reviewSub"><button type="submit" class="deleteBtn">글 삭제</button></a>
                    <a href="/review/reviewSub"><button type="submit" class="deleteBtn">목록</button></a>
                </div>
            </div>
        </div>
    </div>
    <!-- 댓글 작성 부분 -->
    <div id="comment-write">
        <input type="text" id="commentWriter" placeholder="작성자">
        <input type="text" id="commentContents" placeholder="내용">
        <button id="comment-write-btn" onclick="commentWrite()">댓글작성</button>
    </div>

    <!-- 댓글 출력 부분 -->
    <div id="comment-list">
        <table>
            <tr>
                <th>작성자</th>
                <th>내용</th>
                <th>작성시간</th>
            </tr>
            <tr th:each="comment: ${commentList}">
                <td th:text="${comment.commentWriter}"></td>
                <td th:text="${comment.commentContents}"></td>
                <td th:text="${comment.commentCreatedTime}"></td>
            </tr>
        </table>
    </div>
</div>

<footer th:replace="~{fragments/sub/footer::footer}"></footer>
<script src="https:cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script src="/js/sub/header.js"></script>
<script src="/js/review/reviewShow.js"></script>
<script src="/js/sub/footer.js"></script>

<script th:inline="javascript">
    const commentWrite = () => {
        const writer = document.getElementById("commentWriter").value;
        const contents = document.getElementById("commentContents").value;
        console.log("작성자: ", writer);
        console.log("내용: ", contents);
        const id = [[${reviewShow.id}]];    // 게시글 번호
        $.ajax({
           // 요청방식: post, 요청주소: /comment/save, 요청데이터: 작성자, 작성내용, 게시글번호
           type: "post",
           url: "/comment/save",
           data: {
               "commentWriter": writer,
               "commentContents": contents,
               "reviewId": id
           },
           success: function (res) {
               console.log("요청성공", res);
               let output = "<table>";
               output += "<th>작성자</th>";
               output += "<th>내용</th>";
               output += "<th>작성시간</th></tr>";

               for (let i in res) {
                   output += "<tr>";
                   output += "<td>" + res[i].commentWriter + "</td>";
                   output += "<td>" + res[i].commentContents + "</td>";

                   // LocalDateTime 값을 포맷하여 출력
                   let commentCreatedTime = new Date(res[i].commentCreatedTime);
                   let formattedDate = commentCreatedTime.getFullYear() + '-' +
                   ('0' + (commentCreatedTime.getMonth() + 1)).slice(-2) + '-' +
                   ('0' + commentCreatedTime.getDate()).slice(-2);

                   output += "<td>" + formattedDate + "</td>";
                   output += "</tr>";
               }
               output += "</table>";
               document.getElementById('comment-list').innerHTML = output;
               document.getElementById('commentWriter').value = '';
               document.getElementById('commentContents').value = '';
           },
           error: function (err) {
               console.log("요청실패", err);
           }
        });
    }
</script>


</body>

</html>